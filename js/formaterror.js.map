{"version":3,"sources":["/projects/nodejs/botbuilder/abot_stringdist/src/../src/formaterror.ts"],"names":[],"mappings":"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","file":"formaterror.js","sourcesContent":["/**\r\n * @file formaterror.ts\r\n *\r\n * Formats (some) parser errors into a human understandable text\r\n *\r\n * (c) gerd forstmann 2017\r\n */\r\n\r\nimport * as debug from 'debugf';\r\nconst debuglog = debug('formaterror');\r\n\r\nvar abot_erbase = require('abot_erbase');\r\n\r\nimport { IFModel as IFModel } from 'fdevsta_monmove';\r\nimport { Sentence as Sentence, IFErBase as IFErBase } from 'abot_erbase';\r\n\r\n//t[{\"name\":\"NoViableAltException\",\"message\":\"Expecting: one of these possible Token sequences:\\n  1. [AFact]\\n  2. [AnANY]\\nbut found: ''\",\"token\":{\"image\":\"\",\"startOffset\":null,\"endOffset\":null,\"startLine\":null,\"endLine\":null,\"startColumn\":null,\"endColumn\":null,\"tokenType\":1},\"resyncedTokens\":[],\"context\":{\"ruleStack\":[\"catListOpMore\",\"factOrAny\"],\r\n\r\nexport function getTokenText(token : any, sentence : IFErBase.ISentence) {\r\n    return getSentenceToken(token,sentence).string;\r\n}\r\n\r\nexport function getSentenceToken(token : any, sentence : IFErBase.ISentence) : IFErBase.IWord {\r\n    if(Number.isNaN(token.startOffset) || token.startOffset >= sentence.length) {\r\n        throw Error('access outside of index' + token.startOffset + \" / \" + sentence.length);\r\n    }\r\n    return sentence[token.startOffset];\r\n}\r\n\r\n\r\nexport function getTokenQualifier(token : any, sentence : IFErBase.ISentence) {\r\n    return getQualifierFromWordType(getSentenceToken(token,sentence).rule.wordType );\r\n}\r\n\r\nexport function getQualifierFromWordType(wordType : string) : string {\r\n    switch(wordType) {\r\n        case IFModel.WORDTYPE.FACT :\r\n            return \"the fact\";\r\n        case IFModel.WORDTYPE.CATEGORY:\r\n            return \"the category\"\r\n        case IFModel.WORDTYPE.DOMAIN:\r\n            return \"the domain\"\r\n        case IFModel.WORDTYPE.OPERATOR:\r\n            return \"the operator\"\r\n    }\r\n    return \"\";\r\n}\r\n\r\n\r\n\r\nexport interface IParseError {\r\n    text : string,\r\n    error : any\r\n}\r\n\r\nexport function getExpecting(message : string) : string {\r\n//    return \"A\"\r\n//Error: NoViableAltException: Expecting: one of these possible Token sequences:\r\n//  1. [AFact]\r\n//  2. [AnANY]\r\n// todo extract and format alternatives...\r\nreturn 'a fact or a string fragment';\r\n}\r\n\r\nexport function formatError(error : any, sentence : IFErBase.ISentence) : IParseError {\r\n    debuglog(() => 'error : ' + JSON.stringify(error));\r\n    if ((error.name === \"NotAllInputParsedException\") && error.token && (error.token.startOffset !== null) ) {\r\n        var tok = getTokenText(error.token, sentence);\r\n        var qualifier = getTokenQualifier(error.token,sentence);\r\n        return { text :\r\n                `I do not understand ${qualifier} \"${tok}\" at this position in the sentence.`,\r\n                error : error };\r\n    }\r\n    if ((error.name === \"NoViableAltException\") && error.token && (Number.isNaN(error.token.startOffset)) ) {\r\n        var expect = getExpecting(error.message);\r\n        return { text :\r\n                `Sentence terminated unexpectedly, i expected ${expect}.`,\r\n                error : error };\r\n    }\r\n    //(error.name === \"NoViableAltException\")\r\n    return { error : error,\r\n        text : JSON.stringify(error)\r\n    }\r\n}"],"sourceRoot":"ABC"}